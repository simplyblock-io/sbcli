apiVersion: batch/v1
kind: Job
metadata:
  name: {{ JOBNAME }}
  namespace: {{ NAMESPACE }}
spec:
  template:
    spec:
      restartPolicy: OnFailure
      nodeSelector:
        kubernetes.io/hostname: {{ HOSTNAME }}
      hostNetwork: true
      hostPID: true
      serviceAccountName: simplyblock-storage-node-sa
      tolerations:
        - effect: NoSchedule
          operator: Exists
        - effect: NoExecute
          operator: Exists
      volumes:
        - name: boot
          hostPath:
            path: /boot
        - name: usr-bin
          hostPath:
            path: /usr/bin
        - name: usr-sbin
          hostPath:
            path: /usr/sbin
        - name: lib
          hostPath:
            path: /lib
        - name: lib64
          hostPath:
            path: /lib64
        - name: usr-lib
          hostPath:
            path: /usr/lib
        - name: dev
          hostPath:
            path: /dev
        - name: run
          hostPath:
            path: /run
        - name: proc
          hostPath:
            path: /proc
        - name: sys
          hostPath:
            path: /sys
        - name: usr-share
          hostPath:
            path: /usr/share
        - name: etc
          hostPath:
            path: /etc
        - name: rootfs
          hostPath:
            path: /
        - name: var-simplyblock
          hostPath:
            path: /var/simplyblock
      containers:
        - name: init-setup
          image: ubuntu:22.04
          securityContext:
            privileged: true
          volumeMounts:
            - name: boot
              mountPath: /boot
            - name: usr-bin
              mountPath: /usr/bin
            - name: usr-sbin
              mountPath: /usr/sbin
            - name: lib
              mountPath: /lib
            - name: lib64
              mountPath: /lib64
            - name: usr-lib
              mountPath: /usr/lib
            - name: dev
              mountPath: /dev
            - name: run
              mountPath: /run
            - name: proc
              mountPath: /proc
            - name: sys
              mountPath: /sys
            - name: usr-share
              mountPath: /usr/share
            - name: etc
              mountPath: /etc
            - name: rootfs
              mountPath: /host
            - name: var-simplyblock
              mountPath: /var/simplyblock
          command: ["/bin/bash", "-c"]
          args:
            - |
              set -e
              sleep infinity
              